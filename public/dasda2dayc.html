<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚ç‚¹é”€å”®åˆçº¦ - ç®¡ç†åå°</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .wallet-address {
            color: #666;
            font-family: monospace;
            padding: 10px 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #555;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin: 10px 0;
        }

        .node-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .node-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .node-info p {
            color: #666;
            margin: 5px 0;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .recipients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .recipient-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }

        .recipient-item h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .recipient-item p {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ èŠ‚ç‚¹é”€å”®åˆçº¦ - ç®¡ç†åå°</h1>
            <div class="wallet-info">
                <div>
                    <div class="wallet-address" id="walletAddress">æœªè¿æ¥é’±åŒ…</div>
                    <div class="wallet-address" style="margin-top: 10px;">åˆçº¦: <span id="contractAddress">æœªè®¾ç½®</span></div>
                    <div class="wallet-address" style="margin-top: 10px; color: #667eea; font-weight: 600;" id="contractBalance">åˆçº¦ä½™é¢: åŠ è½½ä¸­...</div>
                </div>
                <button id="connectWallet" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
            </div>
        </div>

        <!-- åˆçº¦åœ°å€è®¾ç½® -->
        <div class="section">
            <h2>âš™ï¸ åˆçº¦è®¾ç½®</h2>
            <div class="form-group">
                <label>åˆçº¦åœ°å€</label>
                <input type="text" id="contractAddressInput" placeholder="0x..." />
            </div>
            <button onclick="setContractAddress()">è®¾ç½®åˆçº¦åœ°å€</button>
        </div>

        <!-- æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ -->
        <div class="section">
            <h2>ğŸ“Š èŠ‚ç‚¹ä¿¡æ¯</h2>
            <div class="btn-group">
                <button onclick="loadNodesInfo()">åˆ·æ–°èŠ‚ç‚¹ä¿¡æ¯</button>
                <button onclick="loadContractBalance()">åˆ·æ–°åˆçº¦ä½™é¢</button>
            </div>
            <div id="nodesInfo" style="margin-top: 20px;"></div>
        </div>

        <!-- èŠ‚ç‚¹ä»·æ ¼ç®¡ç† -->
        <div class="section">
            <h2>ğŸ’° èŠ‚ç‚¹ä»·æ ¼ç®¡ç†</h2>
            <div class="grid">
                <div class="form-group">
                    <label>èŠ‚ç‚¹ç±»å‹</label>
                    <select id="priceNodeLevel">
                        <option value="1">è½»é‡èŠ‚ç‚¹ (LITE)</option>
                        <option value="2">ç¥ç»èŠ‚ç‚¹ (NEURAL)</option>
                        <option value="3">é‡å­èŠ‚ç‚¹ (QUANTUM)</option>
                        <option value="4">çŸ©é˜µèŠ‚ç‚¹ (MATRIX)</option>
                        <option value="5">åˆ›ä¸–èŠ‚ç‚¹ (GENESIS)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ–°ä»·æ ¼ (USDT)</label>
                    <input type="number" id="newPrice" placeholder="1000" />
                </div>
            </div>
            <button onclick="updateNodePrice()">æ›´æ–°ä»·æ ¼</button>
            <div id="priceResult"></div>
        </div>

        <!-- èŠ‚ç‚¹é™é‡ç®¡ç† -->
        <div class="section">
            <h2>ğŸ« èŠ‚ç‚¹é™é‡ç®¡ç†</h2>
            <div class="grid">
                <div class="form-group">
                    <label>èŠ‚ç‚¹ç±»å‹</label>
                    <select id="limitNodeLevel">
                        <option value="1">è½»é‡èŠ‚ç‚¹ (LITE)</option>
                        <option value="2">ç¥ç»èŠ‚ç‚¹ (NEURAL)</option>
                        <option value="3">é‡å­èŠ‚ç‚¹ (QUANTUM)</option>
                        <option value="4">çŸ©é˜µèŠ‚ç‚¹ (MATRIX)</option>
                        <option value="5">åˆ›ä¸–èŠ‚ç‚¹ (GENESIS)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é™é‡ä»½æ•° (0è¡¨ç¤ºæ— é™åˆ¶)</label>
                    <input type="number" id="limitAmount" placeholder="1000" value="0" />
                </div>
            </div>
            <button onclick="setNodeLimit()">è®¾ç½®é™é‡</button>
            <div id="limitResult"></div>
        </div>

        <!-- å‡é”€é‡ç®¡ç† -->
        <div class="section">
            <h2>ğŸ“ˆ å‡é”€é‡ç®¡ç†</h2>
            <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ æç¤ºï¼šç›´æ¥è®¾ç½®å‡é”€é‡æ€»æ•°ï¼Œä¸å ç”¨çœŸå®åº“å­˜</p>
            <div class="grid">
                <div class="form-group">
                    <label>èŠ‚ç‚¹ç±»å‹</label>
                    <select id="fakeSalesNodeLevel" onchange="showCurrentFakeSales()">
                        <option value="1">è½»é‡èŠ‚ç‚¹ (LITE)</option>
                        <option value="2">ç¥ç»èŠ‚ç‚¹ (NEURAL)</option>
                        <option value="3">é‡å­èŠ‚ç‚¹ (QUANTUM)</option>
                        <option value="4">çŸ©é˜µèŠ‚ç‚¹ (MATRIX)</option>
                        <option value="5">åˆ›ä¸–èŠ‚ç‚¹ (GENESIS)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è®¾ç½®å‡é”€é‡æ€»æ•°</label>
                    <input type="number" id="fakeSalesAmount" placeholder="100" min="0" />
                    <small id="currentFakeSales" style="color: #666; display: block; margin-top: 5px;"></small>
                </div>
            </div>
            <button onclick="setFakeSales()">è®¾ç½®å‡é”€é‡</button>
            <div id="fakeSalesResult"></div>
        </div>

        <!-- ç‰¹æ®Šèº«ä»½ç®¡ç†ï¼ˆç›´æ¨å¥–åŠ±åŠ æˆï¼‰ -->
        <div class="section">
            <h2>â­ ç‰¹æ®Šèº«ä»½ç®¡ç†ï¼ˆç›´æ¨å¥–åŠ±åŠ æˆï¼‰</h2>
            <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ æç¤ºï¼šç‰¹æ®Šèº«ä»½ä¼šå¢åŠ æ¨èäººçš„ç›´æ¨å¥–åŠ±æ¯”ä¾‹</p>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€</label>
                <input type="text" id="specialStatusAddress" placeholder="0x..." />
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="specialStatusValue">
                    <option value="0">NONE (æ— åŠ æˆ)</option>
                    <option value="1">LEVEL1 (é¢å¤–+5%)</option>
                    <option value="2">LEVEL2 (é¢å¤–+10%)</option>
                </select>
            </div>
            <button onclick="setSpecialStatus()">è®¾ç½®ç‰¹æ®Šèº«ä»½</button>
            <div id="specialStatusResult"></div>
        </div>

        <!-- æ‰¹é‡ç‰¹æ®Šèº«ä»½ç®¡ç† -->
        <div class="section">
            <h2>â­ æ‰¹é‡è®¾ç½®ç‰¹æ®Šèº«ä»½</h2>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ªåœ°å€)</label>
                <textarea id="batchSpecialAddresses" rows="5" placeholder="0x123...&#10;0x456...&#10;0x789..."></textarea>
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="batchSpecialStatus">
                    <option value="0">NONE (æ— åŠ æˆ)</option>
                    <option value="1">LEVEL1 (é¢å¤–+5%)</option>
                    <option value="2">LEVEL2 (é¢å¤–+10%)</option>
                </select>
            </div>
            <button onclick="batchSetSpecialStatus()">æ‰¹é‡è®¾ç½®</button>
            <div id="batchSpecialResult"></div>
        </div>

        <!-- ç‰¹æ®Šæˆå‘˜ç®¡ç† -->
        <div class="section">
            <h2>ğŸŒŸ ç‰¹æ®Šæˆå‘˜ç®¡ç†ï¼ˆç‹¬ç«‹å¥–åŠ±ç³»ç»Ÿï¼‰</h2>
            <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ æç¤ºï¼šä»»ä½•äººä¸‹å•æ—¶ï¼Œä¼šå¾€ä¸Šæ‰¾60ä»£å†…ç¬¬ä¸€ä¸ªç‰¹æ®Šæˆå‘˜ç»™äºˆé¢å¤–å¥–åŠ±ï¼ˆ40%-ç›´æ¨å¥–åŠ±ï¼‰ã€‚å¦‚æœä¸‹å•è€…è‡ªå·±æ˜¯ç‰¹æ®Šæˆå‘˜ï¼Œå¥–åŠ±ç»™è‡ªå·±ã€‚</p>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€</label>
                <input type="text" id="specialMemberAddress" placeholder="0x..." />
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="specialMemberValue">
                    <option value="true">å¼€å¯ï¼ˆè®¾ä¸ºç‰¹æ®Šæˆå‘˜ï¼‰</option>
                    <option value="false">å…³é—­</option>
                </select>
            </div>
            <button onclick="setSpecialMember()">è®¾ç½®ç‰¹æ®Šæˆå‘˜</button>
            <div id="specialMemberResult"></div>
        </div>

        <!-- æ‰¹é‡ç‰¹æ®Šæˆå‘˜ç®¡ç† -->
        <div class="section">
            <h2>ğŸŒŸ æ‰¹é‡è®¾ç½®ç‰¹æ®Šæˆå‘˜</h2>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ªåœ°å€)</label>
                <textarea id="batchSpecialMemberAddresses" rows="5" placeholder="0x123...&#10;0x456...&#10;0x789..."></textarea>
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="batchSpecialMemberStatus">
                    <option value="true">å¼€å¯</option>
                    <option value="false">å…³é—­</option>
                </select>
            </div>
            <button onclick="batchSetSpecialMember()">æ‰¹é‡è®¾ç½®</button>
            <div id="batchSpecialMemberResult"></div>
        </div>

        <!-- é»˜è®¤ç‰¹æ®Šå¥–åŠ±æ¥æ”¶åœ°å€ -->
        <div class="section">
            <h2>ğŸ’¼ é»˜è®¤ç‰¹æ®Šå¥–åŠ±æ¥æ”¶åœ°å€</h2>
            <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ æç¤ºï¼šå½“æ‰¾ä¸åˆ°ç‰¹æ®Šæˆå‘˜ä¸Šçº§æ—¶ï¼Œç‰¹æ®Šå¥–åŠ±å°†å‘é€åˆ°æ­¤é»˜è®¤åœ°å€</p>
            <button onclick="loadDefaultRecipient()" style="margin-bottom: 15px;">æŸ¥çœ‹å½“å‰åœ°å€</button>
            <div id="defaultRecipientInfo" style="margin-bottom: 15px;"></div>
            <div class="form-group">
                <label>æ–°çš„é»˜è®¤æ¥æ”¶åœ°å€</label>
                <input type="text" id="newDefaultRecipient" placeholder="0x..." />
            </div>
            <button onclick="setDefaultSpecialRewardRecipient()">æ›´æ–°é»˜è®¤æ¥æ”¶åœ°å€</button>
            <div id="defaultRecipientResult"></div>
        </div>

        <!-- ç™½åå•ç®¡ç† -->
        <div class="section">
            <h2>ğŸ“‹ ç™½åå•ç®¡ç†</h2>
            <p style="color: #666; margin-bottom: 15px;">ğŸ’¡ æç¤ºï¼šåªæœ‰ç™½åå•ä¸­çš„ç”¨æˆ·æ‰èƒ½è´­ä¹°èŠ‚ç‚¹</p>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€</label>
                <input type="text" id="whitelistAddress" placeholder="0x..." />
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="whitelistValue">
                    <option value="true">åŠ å…¥ç™½åå•</option>
                    <option value="false">ç§»å‡ºç™½åå•</option>
                </select>
            </div>
            <button onclick="setWhitelist()">è®¾ç½®ç™½åå•</button>
            <div id="whitelistResult"></div>
        </div>

        <!-- æ‰¹é‡ç™½åå•ç®¡ç† -->
        <div class="section">
            <h2>ğŸ“‹ æ‰¹é‡è®¾ç½®ç™½åå•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·åœ°å€åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ªåœ°å€)</label>
                <textarea id="batchWhitelistAddresses" rows="5" placeholder="0x123...&#10;0x456...&#10;0x789..."></textarea>
            </div>
            <div class="form-group">
                <label>çŠ¶æ€</label>
                <select id="batchWhitelistStatus">
                    <option value="true">åŠ å…¥ç™½åå•</option>
                    <option value="false">ç§»å‡ºç™½åå•</option>
                </select>
            </div>
            <button onclick="batchSetWhitelist()">æ‰¹é‡è®¾ç½®</button>
            <div id="batchWhitelistResult"></div>
        </div>

        <!-- æ¥æ”¶åœ°å€ç®¡ç† -->
        <div class="section">
            <h2>ğŸ’³ æ¥æ”¶åœ°å€ç®¡ç†</h2>
            <button onclick="loadRecipients()" style="margin-bottom: 15px;">åˆ·æ–°æ¥æ”¶åœ°å€ä¸ä½™é¢</button>
            <div id="recipientsInfo"></div>

            <div style="margin-top: 20px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">ä¿®æ”¹æ¥æ”¶åœ°å€</h3>
                <div class="grid">
                    <div class="form-group">
                        <label>åœ°å€ç¼–å·</label>
                        <select id="recipientIndex">
                            <option value="1">åœ°å€1 (æ¥æ”¶50%)</option>
                            <option value="2">åœ°å€2 (æ¥æ”¶10%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ–°åœ°å€</label>
                        <input type="text" id="newRecipient" placeholder="0x..." />
                    </div>
                </div>
                <button onclick="updateRecipient()">æ›´æ–°æ¥æ”¶åœ°å€</button>
                <div id="recipientResult"></div>
            </div>
        </div>
    </div>

    <script>
        // åˆçº¦ ABI
        const CONTRACT_ABI = [
            "function updateNodePrice(uint8 level, uint256 newPrice) external",
            "function batchUpdateNodePrices(uint8[] calldata levels, uint256[] calldata prices) external",
            "function setNodeLimit(uint8 level, uint256 limit) external",
            "function batchSetNodeLimits(uint8[] calldata levels, uint256[] calldata limits) external",
            "function setFakeSales(uint8 level, uint256 amount) external",
            "function setSpecialStatus(address user, uint8 status) external",
            "function batchSetSpecialStatus(address[] calldata users, uint8 status) external",
            "function setSpecialMember(address user, bool isMember) external",
            "function batchSetSpecialMember(address[] calldata users, bool isMember) external",
            "function setDefaultSpecialRewardRecipient(address newRecipient) external",
            "function setWhitelist(address user, bool isWhitelisted) external",
            "function batchSetWhitelist(address[] calldata users, bool isWhitelisted) external",
            "function updateRecipient(uint8 index, address newRecipient) external",
            "function getAllNodesInfo() view returns (uint8[5], string[5], uint256[5], uint256[5], uint256[5], uint256[5], uint256[5], uint256[5])",
            "function recipient1() view returns (address)",
            "function recipient2() view returns (address)",
            "function defaultSpecialRewardRecipient() view returns (address)",
            "function whitelist(address user) view returns (bool)",
            "function owner() view returns (address)",
            "function usdt() view returns (address)"
        ];

        // ERC20 ABI (ç”¨äºæŸ¥è¯¢ä½™é¢)
        const ERC20_ABI = [
            "function balanceOf(address account) view returns (uint256)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)"
        ];

        let provider;
        let signer;
        let contract;
        let userAddress;

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showError('è¯·å®‰è£… MetaMask!');
                    return;
                }

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = accounts[0];

                document.getElementById('walletAddress').textContent =
                    `å·²è¿æ¥: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;

                showSuccess('é’±åŒ…è¿æ¥æˆåŠŸ!');

                // å¦‚æœå·²è®¾ç½®åˆçº¦åœ°å€ï¼Œåˆå§‹åŒ–åˆçº¦
                const contractAddr = localStorage.getItem('contractAddress');
                if (contractAddr) {
                    document.getElementById('contractAddressInput').value = contractAddr;
                    setContractAddress();
                }
            } catch (error) {
                showError('è¿æ¥é’±åŒ…å¤±è´¥: ' + error.message);
            }
        }

        // è®¾ç½®åˆçº¦åœ°å€
        async function setContractAddress() {
            const address = document.getElementById('contractAddressInput').value;
            if (!ethers.utils.isAddress(address)) {
                showError('æ— æ•ˆçš„åˆçº¦åœ°å€');
                return;
            }

            localStorage.setItem('contractAddress', address);
            document.getElementById('contractAddress').textContent =
                `${address.substring(0, 6)}...${address.substring(38)}`;

            if (signer) {
                contract = new ethers.Contract(address, CONTRACT_ABI, signer);
                showSuccess('åˆçº¦åœ°å€è®¾ç½®æˆåŠŸ!');
                await loadContractBalance();
                loadNodesInfo();
                loadRecipients();
                loadDefaultRecipient();
            }
        }

        // åŠ è½½åˆçº¦USDTä½™é¢
        async function loadContractBalance() {
            if (!contract) {
                return;
            }

            try {
                const usdtAddress = await contract.usdt();
                const contractAddress = contract.address;
                const usdtContract = new ethers.Contract(usdtAddress, ERC20_ABI, provider);
                const balance = await usdtContract.balanceOf(contractAddress);
                const balanceFormatted = ethers.utils.formatUnits(balance, 18);

                document.getElementById('contractBalance').textContent =
                    `åˆçº¦ä½™é¢: ${parseFloat(balanceFormatted).toFixed(2)} USDT`;
            } catch (error) {
                document.getElementById('contractBalance').textContent = 'åˆçº¦ä½™é¢: åŠ è½½å¤±è´¥';
            }
        }

        // åŠ è½½èŠ‚ç‚¹ä¿¡æ¯
        async function loadNodesInfo() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            try {
                const result = await contract.getAllNodesInfo();
                const [levels, names, prices, limits, totalSales, realSales, fakeSales, remainingAmounts] = result;

                // ä¿å­˜åˆ°å…¨å±€å˜é‡
                currentNodesData = {
                    levels,
                    names,
                    prices,
                    limits,
                    totalSales,
                    realSales,
                    fakeSales,
                    remainingAmounts
                };

                const nodeNames = ['è½»é‡èŠ‚ç‚¹', 'ç¥ç»èŠ‚ç‚¹', 'é‡å­èŠ‚ç‚¹', 'çŸ©é˜µèŠ‚ç‚¹', 'åˆ›ä¸–èŠ‚ç‚¹'];
                let html = '';

                for (let i = 0; i < 5; i++) {
                    const priceInUsdt = ethers.utils.formatUnits(prices[i], 18);
                    html += `
                        <div class="node-info">
                            <h3>${nodeNames[i]} (${names[i]})</h3>
                            <p><strong>ä»·æ ¼:</strong> ${priceInUsdt} USDT</p>
                            <p><strong>é™é‡:</strong> ${limits[i].toString() === '0' ? 'æ— é™åˆ¶' : limits[i].toString()}</p>
                            <p><strong>æ€»é”€é‡:</strong> ${totalSales[i].toString()}</p>
                            <p><strong>çœŸå®é”€é‡:</strong> ${realSales[i].toString()}</p>
                            <p><strong>å‡é”€é‡:</strong> ${fakeSales[i].toString()}</p>
                            <p><strong>å‰©ä½™:</strong> ${remainingAmounts[i].toString()}</p>
                        </div>
                    `;
                }

                document.getElementById('nodesInfo').innerHTML = html;

                // æ›´æ–°å½“å‰å‡é”€é‡æ˜¾ç¤º
                showCurrentFakeSales();
            } catch (error) {
                showError('åŠ è½½èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°èŠ‚ç‚¹ä»·æ ¼
        async function updateNodePrice() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const level = document.getElementById('priceNodeLevel').value;
            const price = document.getElementById('newPrice').value;

            if (!price || price <= 0) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼');
                return;
            }

            try {
                showLoading('priceResult');
                // USDT 18ä½å°æ•°
                const priceInWei = ethers.utils.parseUnits(price, 18);
                const tx = await contract.updateNodePrice(level, priceInWei);
                await tx.wait();

                showSuccess('ä»·æ ¼æ›´æ–°æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ' + tx.hash, 'priceResult');
                loadNodesInfo();
                loadContractBalance();
            } catch (error) {
                showError('æ›´æ–°ä»·æ ¼å¤±è´¥: ' + error.message, 'priceResult');
            }
        }

        // è®¾ç½®èŠ‚ç‚¹é™é‡
        async function setNodeLimit() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const level = document.getElementById('limitNodeLevel').value;
            const limit = document.getElementById('limitAmount').value;

            try {
                showLoading('limitResult');
                const tx = await contract.setNodeLimit(level, limit);
                await tx.wait();

                showSuccess('é™é‡è®¾ç½®æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ' + tx.hash, 'limitResult');
                loadNodesInfo();
            } catch (error) {
                showError('è®¾ç½®é™é‡å¤±è´¥: ' + error.message, 'limitResult');
            }
        }

        // å…¨å±€å˜é‡å­˜å‚¨èŠ‚ç‚¹æ•°æ®
        let currentNodesData = null;

        // æ˜¾ç¤ºå½“å‰å‡é”€é‡
        function showCurrentFakeSales() {
            if (!currentNodesData) {
                return;
            }

            const level = parseInt(document.getElementById('fakeSalesNodeLevel').value);
            const levelIndex = level - 1; // level ä»1å¼€å§‹ï¼Œæ•°ç»„ä»0å¼€å§‹
            const currentFake = currentNodesData.fakeSales[levelIndex];

            document.getElementById('currentFakeSales').textContent =
                `å½“å‰å‡é”€é‡: ${currentFake.toString()}`;
        }

        // è®¾ç½®å‡é”€é‡ï¼ˆç›´æ¥è®¾ç½®æ€»æ•°ï¼‰
        async function setFakeSales() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const level = parseInt(document.getElementById('fakeSalesNodeLevel').value);
            const targetAmount = document.getElementById('fakeSalesAmount').value;

            if (!targetAmount || targetAmount < 0) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡');
                return;
            }

            try {
                // è·å–å½“å‰å‡é”€é‡ç”¨äºæ˜¾ç¤º
                let currentFake = 0;
                if (currentNodesData) {
                    const levelIndex = level - 1;
                    currentFake = parseInt(currentNodesData.fakeSales[levelIndex].toString());
                }

                showLoading('fakeSalesResult');
                const tx = await contract.setFakeSales(level, targetAmount);
                await tx.wait();

                showSuccess(`å‡é”€é‡è®¾ç½®æˆåŠŸ! ${currentFake > 0 ? `ä» ${currentFake} æ›´æ–°åˆ° ${targetAmount}` : `è®¾ç½®ä¸º ${targetAmount}`}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'fakeSalesResult');
                await loadNodesInfo();
                showCurrentFakeSales();
            } catch (error) {
                showError('è®¾ç½®å‡é”€é‡å¤±è´¥: ' + error.message, 'fakeSalesResult');
            }
        }

        // è®¾ç½®ç‰¹æ®Šèº«ä»½ï¼ˆç›´æ¨å¥–åŠ±åŠ æˆï¼‰
        async function setSpecialStatus() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const address = document.getElementById('specialStatusAddress').value;
            const status = parseInt(document.getElementById('specialStatusValue').value);

            if (!ethers.utils.isAddress(address)) {
                showError('æ— æ•ˆçš„åœ°å€');
                return;
            }

            try {
                showLoading('specialStatusResult');
                const tx = await contract.setSpecialStatus(address, status);
                await tx.wait();

                const statusName = ['NONE', 'LEVEL1 (+5%)', 'LEVEL2 (+10%)'][status];
                showSuccess(`ç‰¹æ®Šèº«ä»½è®¾ç½®æˆåŠŸ! çŠ¶æ€: ${statusName}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'specialStatusResult');
            } catch (error) {
                showError('è®¾ç½®ç‰¹æ®Šèº«ä»½å¤±è´¥: ' + error.message, 'specialStatusResult');
            }
        }

        // æ‰¹é‡è®¾ç½®ç‰¹æ®Šèº«ä»½
        async function batchSetSpecialStatus() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const addressesText = document.getElementById('batchSpecialAddresses').value;
            const status = parseInt(document.getElementById('batchSpecialStatus').value);

            const addresses = addressesText.split('\n')
                .map(addr => addr.trim())
                .filter(addr => addr.length > 0);

            if (addresses.length === 0) {
                showError('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªåœ°å€');
                return;
            }

            // éªŒè¯æ‰€æœ‰åœ°å€
            for (let addr of addresses) {
                if (!ethers.utils.isAddress(addr)) {
                    showError('æ— æ•ˆçš„åœ°å€: ' + addr);
                    return;
                }
            }

            try {
                showLoading('batchSpecialResult');
                const tx = await contract.batchSetSpecialStatus(addresses, status);
                await tx.wait();

                const statusName = ['NONE', 'LEVEL1 (+5%)', 'LEVEL2 (+10%)'][status];
                showSuccess(`æ‰¹é‡è®¾ç½®æˆåŠŸ! å…±å¤„ç† ${addresses.length} ä¸ªåœ°å€ï¼ŒçŠ¶æ€: ${statusName}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'batchSpecialResult');
            } catch (error) {
                showError('æ‰¹é‡è®¾ç½®å¤±è´¥: ' + error.message, 'batchSpecialResult');
            }
        }

        // è®¾ç½®ç‰¹æ®Šæˆå‘˜
        async function setSpecialMember() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const address = document.getElementById('specialMemberAddress').value;
            const isMember = document.getElementById('specialMemberValue').value === 'true';

            if (!ethers.utils.isAddress(address)) {
                showError('æ— æ•ˆçš„åœ°å€');
                return;
            }

            try {
                showLoading('specialMemberResult');
                const tx = await contract.setSpecialMember(address, isMember);
                await tx.wait();

                showSuccess(`ç‰¹æ®Šæˆå‘˜è®¾ç½®æˆåŠŸ! çŠ¶æ€: ${isMember ? 'å¼€å¯' : 'å…³é—­'}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'specialMemberResult');
            } catch (error) {
                showError('è®¾ç½®ç‰¹æ®Šæˆå‘˜å¤±è´¥: ' + error.message, 'specialMemberResult');
            }
        }

        // æ‰¹é‡è®¾ç½®ç‰¹æ®Šæˆå‘˜
        async function batchSetSpecialMember() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const addressesText = document.getElementById('batchSpecialMemberAddresses').value;
            const isMember = document.getElementById('batchSpecialMemberStatus').value === 'true';

            const addresses = addressesText.split('\n')
                .map(addr => addr.trim())
                .filter(addr => addr.length > 0);

            if (addresses.length === 0) {
                showError('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªåœ°å€');
                return;
            }

            // éªŒè¯æ‰€æœ‰åœ°å€
            for (let addr of addresses) {
                if (!ethers.utils.isAddress(addr)) {
                    showError('æ— æ•ˆçš„åœ°å€: ' + addr);
                    return;
                }
            }

            try {
                showLoading('batchSpecialMemberResult');
                const tx = await contract.batchSetSpecialMember(addresses, isMember);
                await tx.wait();

                showSuccess(`æ‰¹é‡è®¾ç½®æˆåŠŸ! å…±å¤„ç† ${addresses.length} ä¸ªåœ°å€ï¼ŒçŠ¶æ€: ${isMember ? 'å¼€å¯' : 'å…³é—­'}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'batchSpecialMemberResult');
            } catch (error) {
                showError('æ‰¹é‡è®¾ç½®å¤±è´¥: ' + error.message, 'batchSpecialMemberResult');
            }
        }

        // åŠ è½½é»˜è®¤ç‰¹æ®Šå¥–åŠ±æ¥æ”¶åœ°å€
        async function loadDefaultRecipient() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            try {
                const address = await contract.defaultSpecialRewardRecipient();

                let html = '';
                if (address && address !== '0x0000000000000000000000000000000000000000') {
                    // è·å–è¯¥åœ°å€çš„USDTä½™é¢
                    const usdtAddress = await contract.usdt();
                    const usdtContract = new ethers.Contract(usdtAddress, ERC20_ABI, provider);
                    const balance = await usdtContract.balanceOf(address);
                    const balanceFormatted = ethers.utils.formatUnits(balance, 18);

                    html = `
                        <div class="node-info">
                            <h3>å½“å‰é»˜è®¤æ¥æ”¶åœ°å€</h3>
                            <p><strong>åœ°å€:</strong> ${address}</p>
                            <p><strong>USDTä½™é¢:</strong> ${parseFloat(balanceFormatted).toFixed(2)} USDT</p>
                        </div>
                    `;
                } else {
                    html = '<div class="error">âš ï¸ å°šæœªè®¾ç½®é»˜è®¤æ¥æ”¶åœ°å€</div>';
                }

                document.getElementById('defaultRecipientInfo').innerHTML = html;
            } catch (error) {
                showError('åŠ è½½é»˜è®¤æ¥æ”¶åœ°å€å¤±è´¥: ' + error.message);
            }
        }

        // è®¾ç½®é»˜è®¤ç‰¹æ®Šå¥–åŠ±æ¥æ”¶åœ°å€
        async function setDefaultSpecialRewardRecipient() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const newAddr = document.getElementById('newDefaultRecipient').value;

            if (!ethers.utils.isAddress(newAddr)) {
                showError('æ— æ•ˆçš„åœ°å€');
                return;
            }

            try {
                showLoading('defaultRecipientResult');
                const tx = await contract.setDefaultSpecialRewardRecipient(newAddr);
                await tx.wait();

                showSuccess('é»˜è®¤æ¥æ”¶åœ°å€æ›´æ–°æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ' + tx.hash, 'defaultRecipientResult');
                await loadDefaultRecipient();
            } catch (error) {
                showError('æ›´æ–°é»˜è®¤æ¥æ”¶åœ°å€å¤±è´¥: ' + error.message, 'defaultRecipientResult');
            }
        }

        // åŠ è½½æ¥æ”¶åœ°å€
        async function loadRecipients() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            try {
                // è·å–USDTåˆçº¦åœ°å€
                const usdtAddress = await contract.usdt();
                const usdtContract = new ethers.Contract(usdtAddress, ERC20_ABI, provider);

                // è·å–æ‰€æœ‰æ¥æ”¶åœ°å€
                const recipients = [];
                for (let i = 1; i <= 2; i++) {
                    const addr = await contract[`recipient${i}`]();
                    recipients.push(addr);
                }

                // è·å–æ‰€æœ‰æ¥æ”¶åœ°å€çš„USDTä½™é¢
                const balances = [];
                for (let i = 0; i < 2; i++) {
                    const balance = await usdtContract.balanceOf(recipients[i]);
                    balances.push(balance);
                }

                let html = '<div class="recipients-grid">';
                for (let i = 0; i < 2; i++) {
                    const percentage = i === 0 ? '50%' : '10%';
                    const balanceFormatted = ethers.utils.formatUnits(balances[i], 18);
                    html += `
                        <div class="recipient-item">
                            <h4>åœ°å€${i + 1} (${percentage})</h4>
                            <p style="margin-bottom: 8px;">${recipients[i]}</p>
                            <p style="color: #667eea; font-weight: 600;">ä½™é¢: ${parseFloat(balanceFormatted).toFixed(2)} USDT</p>
                        </div>
                    `;
                }
                html += '</div>';

                document.getElementById('recipientsInfo').innerHTML = html;
            } catch (error) {
                showError('åŠ è½½æ¥æ”¶åœ°å€å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°æ¥æ”¶åœ°å€
        async function updateRecipient() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const index = document.getElementById('recipientIndex').value;
            const newAddr = document.getElementById('newRecipient').value;

            if (!ethers.utils.isAddress(newAddr)) {
                showError('æ— æ•ˆçš„åœ°å€');
                return;
            }

            try {
                showLoading('recipientResult');
                const tx = await contract.updateRecipient(index, newAddr);
                await tx.wait();

                showSuccess('æ¥æ”¶åœ°å€æ›´æ–°æˆåŠŸ! äº¤æ˜“å“ˆå¸Œ: ' + tx.hash, 'recipientResult');
                await loadRecipients();
            } catch (error) {
                showError('æ›´æ–°æ¥æ”¶åœ°å€å¤±è´¥: ' + error.message, 'recipientResult');
            }
        }

        // è®¾ç½®ç™½åå•
        async function setWhitelist() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const address = document.getElementById('whitelistAddress').value;
            const isWhitelisted = document.getElementById('whitelistValue').value === 'true';

            if (!ethers.utils.isAddress(address)) {
                showError('æ— æ•ˆçš„åœ°å€');
                return;
            }

            try {
                showLoading('whitelistResult');
                const tx = await contract.setWhitelist(address, isWhitelisted);
                await tx.wait();

                showSuccess(`ç™½åå•è®¾ç½®æˆåŠŸ! çŠ¶æ€: ${isWhitelisted ? 'å·²åŠ å…¥' : 'å·²ç§»å‡º'}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'whitelistResult');
            } catch (error) {
                showError('è®¾ç½®ç™½åå•å¤±è´¥: ' + error.message, 'whitelistResult');
            }
        }

        // æ‰¹é‡è®¾ç½®ç™½åå•
        async function batchSetWhitelist() {
            if (!contract) {
                showError('è¯·å…ˆè®¾ç½®åˆçº¦åœ°å€å¹¶è¿æ¥é’±åŒ…');
                return;
            }

            const addressesText = document.getElementById('batchWhitelistAddresses').value;
            const isWhitelisted = document.getElementById('batchWhitelistStatus').value === 'true';

            const addresses = addressesText.split('\n')
                .map(addr => addr.trim())
                .filter(addr => addr.length > 0);

            if (addresses.length === 0) {
                showError('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªåœ°å€');
                return;
            }

            // éªŒè¯æ‰€æœ‰åœ°å€
            for (let addr of addresses) {
                if (!ethers.utils.isAddress(addr)) {
                    showError('æ— æ•ˆçš„åœ°å€: ' + addr);
                    return;
                }
            }

            try {
                showLoading('batchWhitelistResult');
                const tx = await contract.batchSetWhitelist(addresses, isWhitelisted);
                await tx.wait();

                showSuccess(`æ‰¹é‡è®¾ç½®æˆåŠŸ! å…±å¤„ç† ${addresses.length} ä¸ªåœ°å€ï¼ŒçŠ¶æ€: ${isWhitelisted ? 'å·²åŠ å…¥' : 'å·²ç§»å‡º'}ã€‚äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`, 'batchWhitelistResult');
            } catch (error) {
                showError('æ‰¹é‡è®¾ç½®å¤±è´¥: ' + error.message, 'batchWhitelistResult');
            }
        }

        // å·¥å…·å‡½æ•°
        function showSuccess(message, elementId = null) {
            const html = `<div class="success">âœ… ${message}</div>`;
            if (elementId) {
                document.getElementById(elementId).innerHTML = html;
            } else {
                alert(message);
            }
        }

        function showError(message, elementId = null) {
            const html = `<div class="error">âŒ ${message}</div>`;
            if (elementId) {
                document.getElementById(elementId).innerHTML = html;
            } else {
                alert(message);
            }
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML =
                '<div class="loading">â³ äº¤æ˜“å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</div>';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥é’±åŒ…è¿æ¥
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                // æ£€æŸ¥æ˜¯å¦å·²ç»è¿æ¥
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });
                if (accounts.length > 0) {
                    connectWallet();
                }

                // ç›‘å¬è´¦æˆ·å˜åŒ–
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        connectWallet();
                    } else {
                        location.reload();
                    }
                });

                // ç›‘å¬ç½‘ç»œå˜åŒ–
                window.ethereum.on('chainChanged', () => {
                    location.reload();
                });
            }
        });
    </script>
</body>
</html>
